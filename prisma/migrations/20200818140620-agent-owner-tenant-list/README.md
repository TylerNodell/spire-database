# Migration `20200818140620-agent-owner-tenant-list`

This migration has been generated by Tyler at 8/18/2020, 10:06:20 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "_OwnerToUnit" (
"A" INTEGER NOT NULL,
"B" INTEGER NOT NULL,
FOREIGN KEY ("A") REFERENCES "Owner"("id") ON DELETE CASCADE ON UPDATE CASCADE,

FOREIGN KEY ("B") REFERENCES "Unit"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "_AgentToUnit" (
"A" INTEGER NOT NULL,
"B" INTEGER NOT NULL,
FOREIGN KEY ("A") REFERENCES "Agent"("id") ON DELETE CASCADE ON UPDATE CASCADE,

FOREIGN KEY ("B") REFERENCES "Unit"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

ALTER TABLE "Tenant" ADD COLUMN "unitId" INTEGER ;

CREATE UNIQUE INDEX "_OwnerToUnit_AB_unique" ON "_OwnerToUnit"("A","B")

CREATE  INDEX "_OwnerToUnit_B_index" ON "_OwnerToUnit"("B")

CREATE UNIQUE INDEX "_AgentToUnit_AB_unique" ON "_AgentToUnit"("A","B")

CREATE  INDEX "_AgentToUnit_B_index" ON "_AgentToUnit"("B")

CREATE TABLE "new_Unit" (
"id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
"createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
"buildingId" INTEGER NOT NULL,
"ownerId" INTEGER NOT NULL,
"tenantId" INTEGER ,
"apt" TEXT NOT NULL,
"sale" BOOLEAN NOT NULL,
"agentId" INTEGER NOT NULL,
FOREIGN KEY ("buildingId") REFERENCES "Building"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

INSERT INTO "new_Unit" ("id", "createdAt", "buildingId", "ownerId", "tenantId", "apt", "sale", "agentId") SELECT "id", "createdAt", "buildingId", "ownerId", "tenantId", "apt", "sale", "agentId" FROM "Unit"

PRAGMA foreign_keys=off;
DROP TABLE "Unit";;
PRAGMA foreign_keys=on

ALTER TABLE "new_Unit" RENAME TO "Unit";

CREATE UNIQUE INDEX "Unit.tenantId_unique" ON "Unit"("tenantId")

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200817154018-optional-tenant..20200818140620-agent-owner-tenant-list
--- datamodel.dml
+++ datamodel.dml
@@ -1,62 +1,62 @@
-// 1
-datasource db {
-  provider = "sqlite"
-  url = "***"
-}
-
-// 2
 generator client {
-  provider = "prisma-client-js"
-  experimentalFeatures = ["connectOrCreate"]
+  provider        = "prisma-client-js"
+  previewFeatures = ["connectOrCreate"]
 }
-model Building {
-  id        Int      @id @default(autoincrement())
-  createdAt DateTime @default(now())
-  name      String?
-  address   String
-  units     Unit[]
+///
+datasource db {
+  provider = "sqlite"
+  url = "***"
 }
-model Unit {
-  id         Int      @id @default(autoincrement())
-  createdAt  DateTime @default(now())
-  apt        String
-  sale       Boolean
-  building   Building @relation(fields: [buildingId], references: [id])
-  buildingId Int
-  owner      Owner    @relation(fields: [ownerId], references: [id])
-  ownerId    Int
-  tenant     Tenant?  @relation(fields: [tenantId], references: [id])
-  tenantId   Int?
-  agent      Agent    @relation(fields: [agentId], references: [id])
-  agentId    Int
-}
-
 model Owner {
-  id        Int      @id @default(autoincrement())
+  id        Int      @default(autoincrement()) @id
   createdAt DateTime @default(now())
   name      String
   phone     String?  @unique
   email     String?  @unique
-  units     Unit[]
+  Unit      Unit[]
 }
 model Tenant {
-  id        Int      @id @default(autoincrement())
+  id        Int      @default(autoincrement()) @id
   createdAt DateTime @default(now())
   name      String
   phone     String?  @unique
   email     String?  @unique
-  unit      Unit
+  Unit      Unit?    @relation(fields: [unitId], references: [id])
+  unitId    Int?
 }
 model Agent {
-  id        Int      @id @default(autoincrement())
+  id        Int      @default(autoincrement()) @id
   createdAt DateTime @default(now())
   name      String
-  phone     String   @unique
   email     String   @unique
   password  String
-  units     Unit[]
+  phone     String   @unique
+  Unit      Unit[]
 }
+
+model Building {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  address   String
+  name      String?
+  Unit      Unit[]
+}
+
+model Unit {
+  id         Int      @default(autoincrement()) @id
+  createdAt  DateTime @default(now())
+  buildingId Int
+  ownerId    Int
+  tenantId   Int?     @unique
+  apt        String
+  sale       Boolean
+  agentId    Int
+  Agent      Agent[]
+  Building   Building @relation(fields: [buildingId], references: [id])
+  Owner      Owner[]
+  Tenant     Tenant[]
+}
```


